# -*- coding: latin-1 -*-from PyQt4.QtGui import QImagefrom PyQt4.QtGui import qRed, qGreen, qBlue, qAlpha, qRgbafrom numpy import ndarrayfrom math  import sqrtclass ImageArray:    "To process an image using ARGB arrays"    # constructor    def __init__(self):        self.__nbR = 0  # number of raws        self.__nbC = 0  # number of columns        self.__R = None # matrix (ndarray) of red values        self.__G = None # matrix (ndarray) of green values        self.__B = None # matrix (ndarray) of blue values        self.__A = None # matrix (ndarray) of alpha values        def __InitArrays(self,raw,col):        self.__nbR = raw        self.__nbC = col        self.__R = ndarray((self.__nbR, self.__nbC), dtype=float)        self.__G = ndarray((self.__nbR, self.__nbC), dtype=float)        self.__B = ndarray((self.__nbR, self.__nbC), dtype=float)        self.__A = ndarray((self.__nbR, self.__nbC), dtype=float)    def UniColor(self, weightR, weightG, weightB):        R, G, B = self.__R, self.__G, self.__B        for r in range(self.__nbR):            for c in range(self.__nbC):                niveau =  1./3.*(R[r, c] + G[r, c] + B[r, c])                R[r, c] = weightR*niveau                G[r, c] = weightG*niveau                B[r, c] = weightB*niveau    def LoadImage(self, image):        imageloc = image.convertToFormat(QImage.Format_ARGB32)        self.__InitArrays(imageloc.height(), imageloc.width())        coef = 1./255.        for r in range(self.__nbR):            for c in range(self.__nbC):                pixel = imageloc.pixel(c, r)                self.__R[r,c] = coef*qRed(pixel)                self.__G[r,c] = coef*qGreen(pixel)                self.__B[r,c] = coef*qBlue(pixel)                self.__A[r,c] = coef*qAlpha(pixel)    def ConvertToQImage(self):        image = QImage(self.__nbC, self.__nbR, QImage.Format_ARGB32)        for r in range(self.__nbR):            for c in range(self.__nbC):                image.setPixel(c, r, qRgba( \                    int( 255.0*self.__R[r, c] + 0.5 ), \                    int( 255.0*self.__G[r, c] + 0.5 ), \                    int( 255.0*self.__B[r, c] + 0.5 ), \                    int( 255.0*self.__A[r, c] + 0.5 ) \                    ))        return image        def Negative(self):        self.__R = 1.-self.__R        self.__G = 1.-self.__G        self.__B = 1.-self.__B    #################################################################################  TRAVAIL A FAIRE :################################################################################    def HGradient(self):        R, G, B = self.__R.copy(), self.__G.copy(), self.__B.copy()        for r in range(1,self.__nbR-1):            for c in range(1,self.__nbC-1):                R[r, c]=0.5*(self.__R[r,c+1]-self.__R[r,c-1])                G[r, c]=0.5*(self.__G[r,c+1]-self.__G[r,c-1])                B[r, c]=0.5*(self.__B[r,c+1]-self.__B[r,c-1])        self.__R = R        self.__G = G        self.__B = B    def VGradient(self):        R, G, B = self.__R.copy(), self.__G.copy(), self.__B.copy()        for r in range(1, self.__nbR-1):            for c in range(1, self.__nbC-1):                R[r, c]=0.5*(self.__R[r+1,c]-self.__R[r-1,c])                G[r, c]=0.5*(self.__G[r+1,c]-self.__G[r-1,c])                B[r, c]=0.5*(self.__B[r+1,c]-self.__B[r-1,c])        self.__R = R        self.__G = G        self.__B = B    def Edge(self):        R, G, B = self.__R.copy(), self.__G.copy(), self.__B.copy()        self.HGradient()        Rh, Gh, Bh = self.__R.copy(), self.__G.copy(), self.__B.copy()        self.__R, self.__G, self.__B = R.copy(), G.copy(), B.copy()        self.VGradient()        Rv, Gv, Bv = self.__R.copy(), self.__G.copy(), self.__B.copy()        for r in range(1, self.__nbR-1):            for c in range(1, self.__nbC-1):                self.__R[r, c] = sqrt(Rh[r, c]**2 + Rv[r, c]**2)                self.__G[r, c] = sqrt(Gh[r, c]**2 + Gv[r, c]**2)                self.__B[r, c] = sqrt(Gh[r, c]**2 + Gv[r, c]**2)            def Histogram(self, fileName="cum.png", nbClass=30):        import matplotlib.pyplot as plt        from numpy import array        plt.figure(figsize=(5,3.7))        tabLoc = array([self.__B.flatten(),self.__G.flatten(),self.__R.flatten()]).transpose()        plt.hist(tabLoc, nbClass,                  histtype='bar', normed=True, range=(0.,1.))        plt.savefig(fileName, format='png', transparent=True, dpi=80, bbox_inches='tight')        